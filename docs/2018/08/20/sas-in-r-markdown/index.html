<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" xml:lang="en" lang="en-us">

<head>
<title>R, it&#39;s OK I guess - SAS in R Markdown</title>
  <meta http-equiv="content-type" content="text/html; charset=utf-8">

<meta name="viewport" content="width=device-width, initial-scale=1.0">
<meta name="description" content="">
<meta name="keywords" content="">
<meta name="author" content="R, it&#39;s OK I guess">
<meta name="generator" content="Hugo 0.26" />

  



<link rel="stylesheet" href="http://yui.yahooapis.com/pure/0.6.0/pure-min.css">


    <link rel="stylesheet" href="http://yui.yahooapis.com/pure/0.6.0/grids-responsive-min.css">








<link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/font-awesome/4.5.0/css/font-awesome.min.css">


<link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.7/css/bootstrap.min.css" integrity="sha384-BVYiiSIFeK1dGmJRAkycuHAHRg32OmUcww7on3RYdg4Va+PmSTsz/K68vbdEjh4u" crossorigin="anonymous">
<script src="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.7/js/bootstrap.min.js" integrity="sha384-Tc5IQib027qvyjSMfHjOMaLkfuWVxZxUPnCJA7l2mCWNIpG9mGCD8wGNIcPD7Txa" crossorigin="anonymous"></script>


<link rel="stylesheet" href="../../../../css/tuftesque.css">

</head>

<body>
<div id="layout" class="pure-g">
<article class="pure-u-1">
<header class="brand">
  <h1>
    <a href="../../../../">
      <span id = "blog_logo">
        
          <img src=http://www.utsc.utoronto.ca/~butler/156-front.jpg alt="Blog Logo" style="height: 40px; width:40px">
        
      </span>
      
    </a>
  </h1>
</header>

<section>
  <h1 class="content-title">
  
  <a href="../../../../2018/08/20/sas-in-r-markdown/">SAS in R Markdown</a>
  
  </h1>
  
  
  
  <span class="content-meta">
    
  
  
  
  <i class="fa fa-user">&nbsp;</i><span class="author">
    &nbsp;Ken</span> <br>
    
  
  
  
  <i class="fa fa-calendar"></i>
    &nbsp;Aug 20, 2018
  
  
  
  &nbsp;<i class="fa fa-clock-o"></i>
    &nbsp;10 min read
  
  
  
  <br>
    <i class="fa fa-tags"> </i>
    
    <a  href="../../../../categories/r-markdown">R Markdown</a>
    
    <a  href="../../../../categories/sas">SAS</a>
    
    
    </span>
    
    
    </section>


<section><div id="introduction" class="section level2">
<h2>Introduction</h2>
<p>One of the courses I teach is called Applications of Statistical Methods. It uses (mostly) familiar statistical techniques to provide the background for an introduction to R and SAS. (Students taking it have a course in statistical inference, but I find the ideas of that haven’t typically stuck very well.) In previous years, I have introduced both R and SAS at the same time, which posed a challenge for constructing lecture notes and assignment solutions: how do you run code, that might be in either language, and get the output, without a great deal of copying and pasting?</p>
<p>It became clear to me that the answer lay in some kind of “literate programming”. I used to use a thing called <code>statweave</code>, which worked, but is getting rather old, and is a little finicky (you had to distinguish between output that was a graph and output that was text). It uses LaTeX as its base, with <code>SAScode</code> and <code>Rcode</code> environments that play the role of code chunks in R Markdown. Running Statweave first runs R and/or SAS to get the output, places it in with the LaTeX, and then runs LaTeX on the whole thing. I have a feeling that you had to do something like the <code>ods output</code> thing to get nice graphs, but I might have mis-remembered that.</p>
<p>My current “solution” is a bit of a home-brew. I learned that SAS has a thing called <code>statrep</code>, which is also LaTeX-based, that is SAS’s contribution to the world of reproducible research. The way this works is that you put code chunks (and, in fact, “output chunks”) in special environments in LaTeX code, the same idea as Statweave, but it handles graphs more smoothly. This is a bit awkward to run: first you run LaTeX once, which produces a file of SAS code (taken from the SAS code chunks on your document). You run that code through SAS, which produces no output but which creates files in folders <code>lst</code> and <code>fig</code> with text output and graphs respectively. Then you run LaTeX again, which incorporates the output in the right places in your document.</p>
<p><label for="tufte-mn-" class="margin-toggle">⊕</label><input type="checkbox" id="tufte-mn-" class="margin-toggle"><span class="marginnote">LaTeX users will be familiar with the idea of running it several times.</span></p>
<p>My home-brewed part was to handle source files with code in both R and SAS. I’m familiar enough with LaTeX, so I know about Sweave and files with extension <code>.Rnw</code>. I thought I could probably rig up something that would process both languages at once. After a bit of experimentation, I figured out that it could be done this way:</p>
<ul>
<li>run the <code>.Rnw</code> file through Sweave to produce a <code>.tex</code> file with all the R code and output</li>
<li>run the <code>.tex</code> file through Statrep via LaTeX to produce SAS code to run</li>
<li>run the SAS code</li>
<li>run LaTeX again to turn the previous <code>.tex</code> file into a PDF with all the code and output from both languages.</li>
</ul>
<p>This is a lot to keep straight, so a good way to handle it is via a Makefile. My Makefiles have lines in them like this, this one for a file <code>a1.Rnw</code> that contains child <code>.Rnw</code> files to make an Assignment 1:</p>
<pre><code>a1.tex: a1.Rnw # plus lots of .Rnw files, one per question
    Rscript -e &quot;knitr::knit(\&quot;a1.Rnw\&quot;)&quot;
a1.pdf: a1.tex
    pdflatex a1
    sas a1_SR.sas
    pdflatex a1
    pdflatex a1</code></pre>
<p>The two unindented lines with colons say what depends on what. The first one says that you make <code>a1.tex</code> from <code>a1.Rnw</code>, and so if the latter has changed, you have to re-make the former. The indented line(s) are a “recipe” for making the first file from the second one. In the case of <code>a1.tex</code>, the way to make it is to do the command-line version of “knitting” it. The second unindented line, and the four indented lines below it, say how to get the final <code>.pdf</code> file from the <code>.tex</code> file: run LaTeX to get the SAS code, run the SAS code, run LaTeX again (and once more for luck).</p>
<p>So, at the command line, I type <code>make a1.pdf</code> and it runs whichever of those lines need re-running (depending on what has changed since the last <code>make</code>).</p>
<p>This works, and produces gorgeous output (it is, after all, LaTeX). I use the <code>exam</code> document class for assignments as well, since this provides a nice organization for numbered questions with or without solutions. (I do the solutions first, to make sure the questions work, then hide the solutions to the questions that are to be handed in.)</p>
<p>But, it is LaTeX. Can I do the same kind of thing in R Markdown, which is much nicer to write in? The sticking point is evidently running SAS via R Markdown. Today I learned that this is indeed possible, HTML output and all.</p>
</div>
<div id="using-sas-at-the-command-line-to-get-text-output" class="section level2">
<h2>Using SAS at the command line to get text output</h2>
<p>SAS distinguishes, or at least used to distinguish, two kinds of output: output that is purely tables of numbers, and output that is graphics. (Statrep still makes this distinction.) SAS used to make graphs out of text as well, like so much ASCII art. It’s sometimes hard to shake the impression that SAS hasn’t really progressed far since the days of punched cards, and that graphics was bolted on as something of an after-thought. Text output can be obtained at the command line by putting the commands into a file, running <code>sas</code> on that file, and inspecting a file with a <code>.lst</code> extension (if you have one; if you don’t, you study the <code>.log</code> file to find out what went wrong.)</p>
<p>This file, for example, reads in a data file from the web and finds the means of the numeric variables <code>scrap</code> and <code>speed</code>:</p>
<pre class="bash"><code>cat soap.sas</code></pre>
<pre><code>## filename myurl url &quot;https://www.utsc.utoronto.ca/~butler/c32/soap.txt&quot;;
## 
## proc import
##   datafile=myurl
##   out=soap
##   dbms=dlm
##   replace;
##   getnames=yes;
##   delimiter=&quot; &quot;;
##   
## proc means;
##   var scrap speed;
## </code></pre>
<p>then you run SAS (installed on your machine) from the command line, like this:</p>
<pre class="bash"><code>sas soap.sas</code></pre>
<p>which gives <em>no output</em>, <em>whether it worked or not</em>, and then you look at the output:</p>
<pre class="bash"><code>cat soap.lst</code></pre>
<pre><code>##                                                            The SAS System                       17:17 Wednesday, August 22, 2018   1
## 
##                                                         The MEANS Procedure
## 
##                            Variable     N            Mean         Std Dev         Minimum         Maximum
##                            ------------------------------------------------------------------------------
##                            scrap       27     315.4814815      82.9895129     140.0000000     470.0000000
##                            speed       27     210.1851852      63.4198689     100.0000000     320.0000000
##                            ------------------------------------------------------------------------------</code></pre>
<p>This is all fine and wonderful for text output. <label for="tufte-mn-" class="margin-toggle">⊕</label><input type="checkbox" id="tufte-mn-" class="margin-toggle"><span class="marginnote">Except for the fact that the output lines might be longer than the screen lines for you, and so the Maximum column might be over on the left instead of on the right where it belongs.</span>
But what about graphs? In fact, those people who know SAS through the online SAS Studio only know output in HTML format, text and graphics alike. Can we get that? The answer turns out to be “yes”.</p>
</div>
<div id="sas-markdown" class="section level2">
<h2>SAS Markdown</h2>
<p>If there is R Markdown, then surely there is SAS Markdown, right? Right, an R package by that name. The package provides two “engines” that will run SAS on code chunks (in the same manner that you can run <code>bash</code>, python etc. on code chunks rather than R by saying in the header of the code chunk what kind of code it is).</p>
<p>There is a bit of setup first. You might find that running <code>sas</code> at the command line works for you (in which case it is on your “path”, and you won’t need <code>saspath</code> below), and you might be happy with the SAS defaults, in which case you won’t need <code>sasopts</code> below, but if you want or need either, mimic the examples in the code chunk below:</p>
<pre class="r"><code>library(SASmarkdown)</code></pre>
<pre><code>## sas, saslog, sashtml, and sashtmllog engines</code></pre>
<pre><code>##    are now ready to use.</code></pre>
<pre class="r"><code>saspath = &#39;/usr/local/SASHome/SASFoundation/9.4/sas&#39;
sasopts = &quot;-ls 75&quot;</code></pre>
<p>If SAS is not on your path, what <code>saspath</code> needs to contain is the path to the executable SAS file (which will end in <code>sas.exe</code> if you are on Windows). I am on Linux, so mine looks like the above; I think <code>/usr/local/bin/sas</code> also will work for me. (In fact, leaving this out entirely will work for me, since <code>/usr/local/bin</code> is on my path.)</p>
<p>SAS by default uses a line width for text of I think 132 characters, which probably comes from the width of an old-fashioned line printer. My option sets the default “line size” to 75, which will fit on the screen better.</p>
<p>Let’s start with text output, and see if we can mimic what I did before at the command line. I take everything that was in the command file <code>soap.sas</code> before, and put it in a SAS code chunk like this:</p>
<pre class="sas"><code>filename myurl url &quot;https://www.utsc.utoronto.ca/~butler/c32/soap.txt&quot;;

proc import
  datafile=myurl
  out=soap
  dbms=dlm
  replace;
  getnames=yes;
  delimiter=&quot; &quot;;
  
proc means;
  var scrap speed;</code></pre>
<pre><code>##                             The MEANS Procedure
## 
##  Variable    N           Mean        Std Dev        Minimum        Maximum
##  -------------------------------------------------------------------------
##  scrap      27    315.4814815     82.9895129    140.0000000    470.0000000
##  speed      27    210.1851852     63.4198689    100.0000000    320.0000000
##  -------------------------------------------------------------------------</code></pre>
<p>Success! (The output is a bit narrower than it was before, thanks to my “linesize” option).</p>
<p>In case you are wondering, the data set comes from a factory that makes soap. The production line can be run at different speeds, and <code>scrap</code> measures the amount of scrap soap pieces that is produced (that is, pieces that cannot be made into soap bars and must be thrown away). You might guess that running the line faster produces more scrap. We investigate that later.</p>
<p>There is something to worry about here: the SAS code chunks are independent of each other, and so, for example, data read in in one will not be available in another:</p>
<pre class="sas"><code>filename myurl url &quot;https://www.utsc.utoronto.ca/~butler/c32/soap.txt&quot;;

proc import
  datafile=myurl
  out=soap
  dbms=dlm
  replace;
  getnames=yes;
  delimiter=&quot; &quot;;</code></pre>
<p>That’s the end of my first chunk, and the <code>proc means</code> is in here:</p>
<pre class="sas"><code>2          proc means;
WARNING: The Base SAS Software product with which MEANS is associated will 
         be expiring soon, and is currently in warning mode to indicate 
         this upcoming expiration. Please run PROC SETINIT to obtain more 
         information on your warning period.
ERROR: There is not a default input data set (_LAST_ is _NULL_).
3            var scrap speed;
ERROR: No data set open to look up variables.
ERROR: No data set open to look up variables.
NOTE: The SAS System stopped processing this step because of errors.
NOTE: PROCEDURE MEANS used (Total process time):
      real time           0.00 seconds
      cpu time            0.00 seconds
      

ERROR: Errors printed on page 1.</code></pre>
<p>I put <code>error=T</code> on my code chunk to allow processing of this post to continue and not stop if there is an error. SAS veterans will recognize the output here: it’s the SAS log file, and if you look at the ERRORs, there is (a) no default, that is, most recently created, data set (the one read in by the <code>proc import</code> has disappeared) and (b) thereby no data set to get the variables <code>scrap</code> and <code>speed</code> from.</p>
<p>All right, so how do we get HTML output, including graphs? <code>SASmarkdown</code> contains an engine called <code>sashtml</code> that will do that. I’m going to repeat the above (so that you can compare), and also obtain a scatter plot, all in one code chunk. The raw R Markdown is <a href="https://raw.githubusercontent.com/nxskok/nxskok.github.io/master/content/post/2018-08-20-sas-in-r-markdown.Rmd">here</a>.</p>
<pre class="sashtml"><code>filename myurl url &quot;https://www.utsc.utoronto.ca/~butler/c32/soap.txt&quot;;

proc import
  datafile=myurl
  out=soap
  dbms=dlm
  replace;
  getnames=yes;
  delimiter=&quot; &quot;;

proc means;
  var scrap speed;
  
proc sgplot;
  scatter x=speed y=scrap;</code></pre>
<div class="branch">
<a name="IDX"></a>
<div>
<div align="center">
<!--BEGINTABLE-->
<table class="table" cellspacing="0" cellpadding="7" rules="groups" frame="hsides" summary="Procedure Means: Summary statistics">
<colgroup>
<col>
</colgroup>
<colgroup>
<col>
<col>
<col>
<col>
<col>
</colgroup>
<thead>
<tr>
<th class="l b header" scope="col">
Variable
</th>
<th class="r b header" scope="col">
N
</th>
<th class="r b header" scope="col">
Mean
</th>
<th class="r b header" scope="col">
Std Dev
</th>
<th class="r b header" scope="col">
Minimum
</th>
<th class="r b header" scope="col">
Maximum
</th>
</tr>
</thead>
<tbody>
<tr>
<th class="l stacked_cell data">
<table width="100%" border="0" cellpadding="7" cellspacing="0">
<tr>
<th class="l data top_stacked_value">
scrap
</th>
</tr>
<tr>
<th class="l data bottom_stacked_value">
speed
</th>
</tr>
</table>
</th>
<td class="r stacked_cell data">
<table width="100%" border="0" cellpadding="7" cellspacing="0">
<tr>
<td class="r data top_stacked_value">
27
</td>
</tr>
<tr>
<td class="r data bottom_stacked_value">
27
</td>
</tr>
</table>
</td>
<td class="r stacked_cell data">
<table width="100%" border="0" cellpadding="7" cellspacing="0">
<tr>
<td class="r data top_stacked_value">
315.4814815
</td>
</tr>
<tr>
<td class="r data bottom_stacked_value">
210.1851852
</td>
</tr>
</table>
</td>
<td class="r stacked_cell data">
<table width="100%" border="0" cellpadding="7" cellspacing="0">
<tr>
<td class="r data top_stacked_value">
82.9895129
</td>
</tr>
<tr>
<td class="r data bottom_stacked_value">
63.4198689
</td>
</tr>
</table>
</td>
<td class="r stacked_cell data">
<table width="100%" border="0" cellpadding="7" cellspacing="0">
<tr>
<td class="r data top_stacked_value">
140.0000000
</td>
</tr>
<tr>
<td class="r data bottom_stacked_value">
100.0000000
</td>
</tr>
</table>
</td>
<td class="r stacked_cell data">
<table width="100%" border="0" cellpadding="7" cellspacing="0">
<tr>
<td class="r data top_stacked_value">
470.0000000
</td>
</tr>
<tr>
<td class="r data bottom_stacked_value">
320.0000000
</td>
</tr>
</table>
</td>
</tr>
</tbody>
</table>
<!--ENDTABLE-->
</div>
</div>
<br>
</div>
<div class="branch">
<p style="page-break-after: always;">
<br/>
</p>
<hr size="3"/>
<a name="IDX1"></a>
<div>
<div class="c">
<p><img alt="The SGPlot Procedure" src="bigsas.png" style=" height: 480px; width: 640px;" border="0" class="c"></p>
</div>
</div>
<br>
</div>
<p><img src="../../../../bigsas.png" /></p>
<p><label for="tufte-mn-" class="margin-toggle">⊕</label><input type="checkbox" id="tufte-mn-" class="margin-toggle"><span class="marginnote">I had to cheat slightly, since SASmarkdown didn’t put the image where blogdown expected it to be.</span></p>
<p>The table of means has come out exactly as before, and the scatterplot confirms what we suspected, that running the production line at a higher speed tends to produce more scrap.</p>
</div>
<div id="concluding-remarks" class="section level2">
<h2>Concluding remarks</h2>
<p>The way to run SAS in R Markdown is to put the <em>whole</em> analysis in one chunk, so that the data set is accessible all the way through. This is rather reminiscent of the 1970s way of running SAS on punched cards: submit the job, wait, then get pages of output to leaf through. A better way would be to save the data as a permanent data set, then refer to the permanent data set using <code>data=</code> all the way through. That way, you could stick with small code chunks for each piece of the analysis.</p>
<p>The output comes out nicely in HTML, but when I tried to knit as PDF or Word, things didn’t come out properly. So the package would be excellent for producing output intended for web viewing. I think I’m going to stick with my Sweave approach for now, but it’s very nice to know that this kind of thing exists.</p>
</div>
<div id="references" class="section level2">
<h2>References</h2>
<p><a href="http://homepage.divms.uiowa.edu/~rlenth/StatWeave/">Statweave</a></p>
<p><a href="https://support.sas.com/rnd/app/papers/statrep.html">Statrep</a></p>
<p><a href="https://www.ssc.wisc.edu/~hemken/SASworkshops/Markdown/SASmdpackage.html">SASmarkdown package intro</a></p>
<p>SASmarkdown usage: for <a href="https://www.ssc.wisc.edu/~hemken/SASworkshops/Markdown/SASmarkdown.html">Windows</a> and <a href="https://www.ssc.wisc.edu/~hemken/SASworkshops/Markdown/sasmarkdownlinux.html">Linux</a></p>
<p><a href="https://www.ssc.wisc.edu/~hemken/SASworkshops/Markdown/SAShtmlengine.html">SAS HTML output</a></p>
</div>
</section>
<section>
  

  



  <div id="disqus_thread"></div>
<script>
(function() {
var d = document, s = d.createElement('script');
s.src = 'https://kens-blog-2.disqus.com/embed.js';
s.setAttribute('data-timestamp', +new Date());
(d.head || d.body).appendChild(s);
})();
</script>
<noscript>Please enable JavaScript to view the <a href="https://disqus.com/?ref_noscript">comments powered by Disqus.</a></noscript>

  <footer class="page-footer">
		<hr>
		<ul class="page-footer-menu">
		
		</ul>

  

	<div class="copyright">
	<p>
    
      &copy; 2018
    .
    All rights reserved.
    
  </p>
</div>
<script type="text/x-mathjax-config">
    MathJax.Hub.Config({
      tex2jax: {
        skipTags: ['script', 'noscript', 'style', 'textarea', 'pre']
      }
    });
    </script>
    <script type="text/javascript"
      src="https://cdn.mathjax.org/mathjax/latest/MathJax.js?config=TeX-AMS-MML_HTMLorMML">
    </script>
</footer>

</section>
</article>
</div>
</body>
</html>
